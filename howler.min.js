/*!
 *  howler.js v1.1.4
 *  howlerjs.com
 *
 *  (c) 2013, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
(function(){var cache={};var ctx=null,usingWebAudio=true,noAudio=false;if(typeof AudioContext!=="undefined"){ctx=new AudioContext}else if(typeof webkitAudioContext!=="undefined"){ctx=new webkitAudioContext}else if(typeof Audio!=="undefined"){usingWebAudio=false}else{usingWebAudio=false;noAudio=true}if(usingWebAudio){var masterGain=typeof ctx.createGain==="undefined"?ctx.createGainNode():ctx.createGain();masterGain.gain.value=1;masterGain.connect(ctx.destination)}var HowlerGlobal=function(){this._volume=1;this._muted=false;this.usingWebAudio=usingWebAudio;this._howls=[]};HowlerGlobal.prototype={volume:function(vol){var self=this;vol=parseFloat(vol);if(vol&&vol>=0&&vol<=1){self._volume=vol;if(usingWebAudio){masterGain.gain.value=vol}for(var key in self._howls){if(self._howls.hasOwnProperty(key)&&self._howls[key]._webAudio===false){for(var i=0;i<self._howls[key]._audioNode.length;i++){self._howls[key]._audioNode[i].volume=self._howls[key]._volume*self._volume}}}return self}return usingWebAudio?masterGain.gain.value:self._volume},mute:function(){var self=this;self._muted=true;if(usingWebAudio){masterGain.gain.value=0}for(var key in self._howls){if(self._howls.hasOwnProperty(key)&&self._howls[key]._webAudio===false){for(var i=0;i<self._howls[key]._audioNode.length;i++){self._howls[key]._audioNode[i].muted=true}}}return self},unmute:function(){var self=this;self._muted=false;if(usingWebAudio){masterGain.gain.value=self._volume}for(var key in self._howls){if(self._howls.hasOwnProperty(key)&&self._howls[key]._webAudio===false){for(var i=0;i<self._howls[key]._audioNode.length;i++){self._howls[key]._audioNode[i].muted=false}}}return self}};var Howler=new HowlerGlobal;var audioTest=null;if(!noAudio){audioTest=new Audio;var codecs={mp3:!!audioTest.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!audioTest.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),webm:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var Howl=function(o){var self=this;self._autoplay=o.autoplay||false;self._buffer=o.buffer||false;self._duration=o.duration||0;self._format=o.format||null;self._loop=o.loop||false;self._loaded=false;self._sprite=o.sprite||{};self._src=o.src||"";self._pos3d=o.pos3d||[0,0,-.5];self._volume=o.volume||1;self._urls=o.urls||[];self._onload=[o.onload||function(){}];self._onloaderror=[o.onloaderror||function(){}];self._onend=[o.onend||function(){}];self._onpause=[o.onpause||function(){}];self._onplay=[o.onplay||function(){}];self._onendTimer=[];self._webAudio=usingWebAudio&&!self._buffer;self._audioNode=[];if(self._webAudio){self._setupAudioNode()}Howler._howls.push(self);self.load()};Howl.prototype={load:function(){var self=this,url=null;if(noAudio){self.on("loaderror");return}for(var i=0;i<self._urls.length;i++){var ext=self._urls[i].toLowerCase().match(/.+\.([^?]+)(\?|$)/),canPlay=false;ext=ext&&ext.length>=2?ext[1]:self._urls[i].toLowerCase().match(/data\:audio\/([^?]+);/)[1];if(self._format){ext=self._format}switch(ext){case"mp3":canPlay=codecs.mp3;break;case"opus":canPlay=codecs.opus;break;case"ogg":canPlay=codecs.ogg;break;case"wav":canPlay=codecs.wav;break;case"m4a":canPlay=codecs.m4a;break;case"weba":canPlay=codecs.webm;break}if(canPlay===true){url=self._urls[i];break}}if(!url){self.on("loaderror");return}self._src=url;if(self._webAudio){loadBuffer(self,url)}else{var newNode=new Audio;self._audioNode.push(newNode);newNode.src=url;newNode._pos=0;newNode.preload="auto";newNode.volume=Howler._muted?0:self._volume*Howler.volume();cache[url]=self;var listener=function(){self._duration=newNode.duration;if(Object.getOwnPropertyNames(self._sprite).length===0){self._sprite={_default:[0,self._duration*1e3]}}if(!self._loaded){self._loaded=true;self.on("load")}if(self._autoplay){self.play()}newNode.removeEventListener("canplaythrough",listener,false)};newNode.addEventListener("canplaythrough",listener,false);newNode.load()}return self},urls:function(urls){var self=this;if(urls){self._urls=urls;self._loaded=false;self.stop();self.load();return self}else{return self._urls}},play:function(sprite,callback){var self=this;if(!sprite){sprite="_default"}if(!self._loaded){self.on("load",function(){self.play(sprite,callback)});return self}if(!self._sprite[sprite]){if(typeof callback==="function")callback();return self}self._inactiveNode(function(node){node._sprite=sprite;var pos=node._pos>0?node._pos:self._sprite[sprite][0]/1e3,duration=self._sprite[sprite][1]/1e3-node._pos;var loop=!!(self._loop||self._sprite[sprite][2]);var soundId=typeof callback==="string"?callback:Math.round(Date.now()*Math.random())+"",timerId;(function(){var data={id:soundId,sprite:sprite,loop:loop};timerId=setTimeout(function(){if(!self._webAudio&&loop){self.stop(data.id,data.timer).play(sprite,data.id)}if(self._webAudio&&!loop){self._nodeById(data.id).paused=true}if(!self._webAudio&&!loop){self.stop(data.id,data.timer)}self.on("end",soundId)},duration*1e3);self._onendTimer.push(timerId);data.timer=self._onendTimer[self._onendTimer.length-1]})();if(self._webAudio){node.id=soundId;node.paused=false;refreshBuffer(self,[loop,pos,duration],soundId);self._playStart=ctx.currentTime;node.gain.value=self._volume;if(typeof node.bufferSource.start==="undefined"){node.bufferSource.noteGrainOn(0,pos,duration)}else{node.bufferSource.start(0,pos,duration)}}else{if(node.readyState===4){node.id=soundId;node.currentTime=pos;node.muted=Howler._muted;node.volume=self._volume*Howler.volume();node.play()}else{self._clearEndTimer(timerId);(function(){var sound=self,playSprite=sprite,fn=callback,newNode=node;var listener=function(){sound.play(playSprite,fn);newNode.removeEventListener("canplaythrough",listener,false)};newNode.addEventListener("canplaythrough",listener,false)})();return self}}self.on("play");if(typeof callback==="function")callback(soundId);return self});return self},pause:function(id,timerId){var self=this;if(!self._loaded){self.on("play",function(){self.pause(id)});return self}self._clearEndTimer(timerId||0);var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){if(self._webAudio){if(!activeNode.bufferSource){return self}activeNode.paused=true;activeNode._pos+=ctx.currentTime-self._playStart;if(typeof activeNode.bufferSource.stop==="undefined"){activeNode.bufferSource.noteOff(0)}else{activeNode.bufferSource.stop(0)}}else{activeNode._pos=activeNode.currentTime;activeNode.pause()}}self.on("pause");return self},stop:function(id,timerId){var self=this;if(!self._loaded){self.on("play",function(){self.stop(id)});return self}self._clearEndTimer(timerId||0);var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){activeNode._pos=0;if(self._webAudio){if(!activeNode.bufferSource){return self}activeNode.paused=true;if(typeof activeNode.bufferSource.stop==="undefined"){activeNode.bufferSource.noteOff(0)}else{activeNode.bufferSource.stop(0)}}else{activeNode.pause();activeNode.currentTime=0}}return self},mute:function(id){var self=this;if(!self._loaded){self.on("play",function(){self.mute(id)});return self}var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){if(self._webAudio){activeNode.gain.value=0}else{activeNode.volume=0}}return self},unmute:function(id){var self=this;if(!self._loaded){self.on("play",function(){self.unmute(id)});return self}var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){if(self._webAudio){activeNode.gain.value=self._volume}else{activeNode.volume=self._volume}}return self},volume:function(vol,id){var self=this;vol=parseFloat(vol);if(!self._loaded){self.on("play",function(){self.volume(vol,id)});return self}if(vol>=0&&vol<=1){self._volume=vol;var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){if(self._webAudio){activeNode.gain.value=vol}else{activeNode.volume=vol*Howler.volume()}}return self}else{return self._volume}},loop:function(loop){var self=this;if(typeof loop==="boolean"){self._loop=loop;return self}else{return self._loop}},sprite:function(sprite){var self=this;if(typeof sprite==="object"){self._sprite=sprite;return self}else{return self._sprite}},pos:function(pos,id){var self=this;if(!self._loaded){self.on("load",function(){self.pos(pos)});return self}var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){if(self._webAudio){if(pos>=0){activeNode._pos=pos;self.pause(id).play(activeNode._sprite,id);return self}else{return activeNode._pos+(ctx.currentTime-self._playStart)}}else{if(pos>=0){activeNode.currentTime=pos;return self}else{return activeNode.currentTime}}}},pos3d:function(x,y,z,id){var self=this;y=typeof y==="undefined"||!y?0:y;z=typeof z==="undefined"||!z?-.5:z;if(!self._loaded){self.on("play",function(){self.pos3d(x,y,z,id)});return self}if(x>=0||x<0){if(self._webAudio){var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode){self._pos3d=[x,y,z];activeNode.panner.setPosition(x,y,z)}}}else{return self._pos3d}return self},fadeIn:function(to,len,callback){var self=this,dist=to,iterations=dist/.01,hold=len/iterations;if(!self._loaded){self.on("load",function(){self.fadeIn(to,len,callback)});return self}self.volume(0).play();for(var i=1;i<=iterations;i++){(function(){var vol=Math.round(1e3*(self._volume+.01*i))/1e3,toVol=to;setTimeout(function(){self.volume(vol);if(vol===toVol){if(callback)callback()}},hold*i)})()}return self},fadeOut:function(to,len,callback,id){var self=this,dist=self._volume-to,iterations=dist/.01,hold=len/iterations;if(!self._loaded){self.on("play",function(){self.fadeOut(to,len,callback,id)});return self}for(var i=1;i<=iterations;i++){(function(){var vol=Math.round(1e3*(self._volume-.01*i))/1e3,toVol=to;setTimeout(function(){self.volume(vol,id);if(vol===toVol){if(callback)callback();self.pause(id);self.on("end")}},hold*i)})()}return self},_nodeById:function(id){var self=this,node=self._audioNode[0];for(var i=0;i<self._audioNode.length;i++){if(self._audioNode[i].id===id){node=self._audioNode[i];break}}return node},_activeNode:function(){var self=this,node=null;for(var i=0;i<self._audioNode.length;i++){if(!self._audioNode[i].paused){node=self._audioNode[i];break}}self._drainPool();return node},_inactiveNode:function(callback){var self=this,node=null;for(var i=0;i<self._audioNode.length;i++){if(self._audioNode[i].paused&&self._audioNode[i].readyState===4){callback(self._audioNode[i]);node=true;break}}self._drainPool();if(node){return}var newNode;if(self._webAudio){newNode=self._setupAudioNode();callback(newNode)}else{self.load();newNode=self._audioNode[self._audioNode.length-1];newNode.addEventListener("loadedmetadata",function(){callback(newNode)})}},_drainPool:function(){var self=this,inactive=0,i;for(i=0;i<self._audioNode.length;i++){if(self._audioNode[i].paused){inactive++}}for(i=self._audioNode.length-1;i>=0;i--){if(inactive<=5){break}if(self._audioNode[i].paused){inactive--;self._audioNode.splice(i,1)}}},_clearEndTimer:function(timerId){var self=this,timer=self._onendTimer.indexOf(timerId);timer=timer>=0?timer:0;if(self._onendTimer[timer]){clearTimeout(self._onendTimer[timer]);self._onendTimer.splice(timer,1)}},_setupAudioNode:function(){var self=this,node=self._audioNode,index=self._audioNode.length;node[index]=typeof ctx.createGain==="undefined"?ctx.createGainNode():ctx.createGain();node[index].gain.value=self._volume;node[index].paused=true;node[index]._pos=0;node[index].readyState=4;node[index].connect(masterGain);node[index].panner=ctx.createPanner();node[index].panner.setPosition(self._pos3d[0],self._pos3d[1],self._pos3d[2]);node[index].panner.connect(node[index]);return node[index]},on:function(event,fn){var self=this,events=self["_on"+event];if(typeof fn==="function"){events.push(fn)}else{for(var i=0;i<events.length;i++){if(fn){events[i].call(self,fn)}}}return self},off:function(event,fn){var self=this,events=self["_on"+event],fnString=fn.toString();for(var i=0;i<events.length;i++){if(fnString===events[i].toString()){events.splice(i,1);break}}return self}};if(usingWebAudio){var loadBuffer=function(obj,url){if(url in cache){obj._duration=cache[url].duration;loadSound(obj)}else{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function(){ctx.decodeAudioData(xhr.response,function(buffer){if(buffer){cache[url]=buffer;loadSound(obj,buffer)}})};xhr.onerror=function(){if(obj._webAudio){obj._buffer=true;obj._webAudio=false;obj._audioNode=[];delete obj._gainNode;obj.load()}};try{xhr.send()}catch(e){xhr.onerror()}}};var loadSound=function(obj,buffer){obj._duration=buffer?buffer.duration:obj._duration;if(Object.getOwnPropertyNames(obj._sprite).length===0){obj._sprite={_default:[0,obj._duration*1e3]}}if(!obj._loaded){obj._loaded=true;obj.on("load")}if(obj._autoplay){obj.play()}};var refreshBuffer=function(obj,loop,id){var node=obj._nodeById(id);node.bufferSource=ctx.createBufferSource();node.bufferSource.buffer=cache[obj._src];node.bufferSource.connect(node.panner);node.bufferSource.loop=loop[0];if(loop[0]){node.bufferSource.loopStart=loop[1];node.bufferSource.loopEnd=loop[1]+loop[2]}}}if(typeof define==="function"&&define.amd){define("Howler",function(){return{Howler:Howler,Howl:Howl}})}else{window.Howler=Howler;window.Howl=Howl}})();